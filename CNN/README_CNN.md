
##### CNN predictions of the intensity and the age of selection using the python script "CNN_aDNA.py" (Keras, TensorFlow).
-------------

Running the CNN predictions with CNN_aDNA.py

./RUN_CNN_aDNA.sh

------


##### Setting files

1 - SETTINGS_MAIN.txt.
A tabulated text file to set various options for computations. 

	- analyse:		NORMAL / CUSTOM ( to handle the files given in example, see below )
	- usage:			PREDICTION (for performing predictions from a trained model )/ TRAINING (for training a model performing predictions )
	- name_model:		For giving a name of the CNN model
	- verbose:		To print some variables


2 - Settings for the CNN architectures.
Various tabulated text files can be used to set the CNN architecture. Example of files to set the simplified CNN architecture, SETTINGS_CNN_architecture_simplified.txt.

	- Settings for convolution layers: Conv1D	28	10	my1Dconvolution_2. The sring "Conv1D" calls for	keras.layers.Conv1D( 28 , kernel_size=10, input_shape=input_shape, name=name[i])
	- Settings for  Pooling layers: Pool1D	2	NA	myMaxPool_2. The string "Pool1D" calls for	keras.layers.MaxPooling1D(pool_size=poolsize)
	- Settings for  Flaten layers: Flatten	NA	NA	myFlatten_1. The string "Flatten" calls for	layers.Flatten()(x)
	- Settings for  dense layers: Dense	128	NA	myDense_1. The string "Dense" calls for	keras.layers.Dense(nbdense, activation=tf.nn.relu)(x)

-----

##### Output files
To separate input data (training files, empirical data files, see below) and the outputs generated by CNN-aDNA.py, the output files are mandatory stored in the folder 'crossval' created by the users in the current directory.
Change CNN_aDNA.py to modify it.

1 - For cross validations.
Tabulated text file that stores the CNN predictions for the simulated pseudo-emprical datasets. Two output layers of 100 neurons each are used to obtain joint estimations of s and T. Consequently, s and T were thus discretized in 100 bins, each being an integer varrying beween 0 and 99 [ s(or T)    = min +( bin * ( (max-min)/numbin) ) ].
name_model is the name of the CNN model defined by users in the setting file 'SETTINGS_MAIN.txt'. Here, it was set to be 'My_CNN_architecture'.

	- '/crossval/pred_crossvalidation_' + name_model + '.txt'
	column 1	"true_s"	True s value ( value used to simulated pseudo-empirical data for cross s)
	column 2	"cnn_s"		maximum likelihood s value
	column 3	"l_max_s"	corresponding likelihood 
	column 4	"cnn_s_post"	posterior average of s (from posterior distribution)
	column 5	"true_t"	True T value ( value used to simulated pseudo-empirical data for cross s)		
	column 6	"cnn_t"		maximum likelihood T value		
	column 7	"l_max_t"	corresponding likelihood 	
	column 8	"cnn_t_post"	posterior average of T (from posterior distribution)
	column 9	"cnn_s_post_2"	posterior average of s (same value as in column 4)
	column 10	"cnn_s_ICmin"	95% CI lower bound of s (from posterior distribution)
	column 11	"cnn_s_ICmax"	95% CI higher bound of s (from posterior distribution)
	column 12	"cnn_t_post_2"	posterior average of T (same value as in column 7)	
	column 13	"cnn_t_ICmin"	95% CI lower bound of T (from posterior distribution)
	column 14	"cnn_t_ICmax"	95% CI higher bound of T (from posterior distribution)


2 - Ror emprical data.
Tabulated text file that stores the CNN predictions for the real datasets.
snp_name is the name of the real variant analyzed read in the file '0-Variant_analyzed.txt' by the script 'RUN_CNN-ADNA.sh'

	raw files of the CNN predictions of s and T
	- /crossval/empirical_validation_pred_' + snp_name + '_' + name_model + '.txt' (same columns as described above, only true values are missing)
	raw files of the posterior distributions of s and T
	- /crossval/empirical_validation_posterior_selcoeff_' + snp_name + '_' + name_model + '.txt'
	- /crossval/empirical_validation_posterior_onsetsel_' + snp_name + '_' + name_model + '.txt'
	


-----


###### Data files 
We provide simulated and empirical files necessary for estimating the selection parameters for the lactase persistence variant (rs4988235, LCT-MCM6). These example files can be found in the folder LCT.

1 - Training files.
Files storing simulated data used to train the model.

	- "A_trainingset_476800_1D_grayscale_images_POSSEL_SNP_rs4988235.READY.txt". List of simulated 1D images with 1 image per raw. A 1D image is the list of 0 and 1, 0 being the ancestral allele, 1 being the derived allele. Here ancient individuals are sorted by age and are pseudo-haploids (1 allele er genotype) and modern individuals are diploids. 
	- "A_trainingset_476800_params_POSSEL_SNP_rs4988235.READY.txt". List of the corresponding simulated parameters (the labels of the simulated images). The column 1 is the selection coefficient. The column 2 is the the age of selection (the rank, ascending order, of the simulated generations in SLiM).

Note: the simulated files provided were simulated according the number and the age of the ancient individuals with genotypes for the lactase persistence allele.

2 - Cross validations files.
Files storing simulated data used to assess the accuracy of the CNN predictions. These simulated data are used as being empirical data for which the value of the parameters are known. For each of these simulated data, the CNN_aDNA.py script estimates the s and T values using the model trained from the simulated data shown above.

	- "A_crossvalset_476800_200_1D_grayscale_images_POSSEL_SNP_rs4988235.READY.txt". List of simulated 1D images with 1 image per raw, see above.
	- "A_crossvalset_476800_200_params_POSSEL_SNP_rs4988235.READY.txt". List of the simulated parameters corresponding to the simulated images used for cross validations, see above.

3 - Empirical files.
"empirical_1D_image_rs4988235.txt", the 1D image for the lactase persistence allele (same shape as for the simulated 1D image shown above).

--------------


###### ABC predictions

Running the ABC predictions with the R script "ABC_freqTraj.r" (R package ABC, Csillery et. al, https://cran.r-project.org/web/packages/abc/index.html)

./RUN_CNN_ABC.sh

1 - Files for ABC estimations.
We also provide the alle frequencies trajectories to perform the ABC estimations of s and T.

	- "A_abc_real_data_freqTraj_rs4988235.txt". Empirical trajectories for the lactase persistence variant (rs4988235, LCT-MCM6).
	- "A_abc_trainingset_476800_freqTraj_POSSEL_SNP_rs4988235.READY.txt". Simulated trajectories corresponding to the simulated data used to train the CNN (see above).
	- "A_abc_crossvalset_476800_200_freqTraj_POSSEL_SNP_rs4988235.READY.txt. Simulated trajectories corresponding to the simulated data used for cross validations (see above).
 
Note: the simulated values of parameters are stored in the "A_trainingset_476800_params_POSSEL_SNP_rs4988235.READY.txt" and "A_crossvalset_476800_200_params_POSSEL_SNP_rs4988235.READY.txt" files (see above).

2 - ABC output files.
Tabulated text file that stores the ABC predictions, mandatory stored in the folder 'crossval' created by the users in the current directory.

	- "/crossval/abc_estimations_crossvalidation.txt" 
	column 1	"true_sel"	True s value ( value used to simulated pseudo-empirical data for cross s)
	column 2	"true_sel"	True T value ( value used to simulated pseudo-empirical data for cross s)	
	column 3	"abc_sel"	posterior mode of s (same value as in column 4)
	column 4	"IC_95"		95% CI lower bound of s (from posterior distribution)
	column 5	"IC_95"		95% CI higher bound of s (from posterior distribution)
	column 6	"abc_age"	posterior mode of T (same value as in column 7)	
	column 7	"IC_95"		95% CI lower bound of T (from posterior distribution)
	column 8	"IC_95"		95% CI higher bound of T (from posterior distribution)

Tabulated text file that stores the ABC predictions for the real datasets.
variant is the name of the real variant analyzed read in the file '0-Variant_analyzed.txt'

	raw files of the CNN predictions of s and T
	- "/crossval/abc_estimations_",variant,".txt" (same columns as described above, only true values are missing)
	raw files of the posterior distributions of s and T
	- "/crossval/abc_posteriors_",variant,".txt")
	









